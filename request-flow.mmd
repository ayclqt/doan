sequenceDiagram
    participant User as Người dùng
    participant CLI as Giao diện CLI
    participant Chatbot as ProductChatbot
    participant Chain as Retrieval Chain
    participant VectorStore as VectorStore
    participant DB as ChromaDB
    participant LLM as OpenAI LLM
    
    User->>CLI: Chọn lệnh chat
    CLI->>Chatbot: Khởi tạo ProductChatbot
    Chatbot->>VectorStore: Khởi tạo VectorStore
    VectorStore->>DB: Kết nối với ChromaDB
    Chatbot->>LLM: Khởi tạo ChatOpenAI
    Chatbot->>Chain: Xây dựng retrieval_chain
    
    loop Phiên chat
        User->>CLI: Nhập câu hỏi
        
        alt Lệnh đặc biệt
            alt Lệnh /exit
                CLI-->>User: Thoát phiên chat
            else Lệnh /reset
                CLI->>Chatbot: reset_chat_history()
                Chatbot-->>CLI: Xác nhận đã xóa
                CLI-->>User: Thông báo đã xóa lịch sử
            end
        else Truy vấn thông thường
            CLI->>Chatbot: ask(question)
            Chatbot->>Chatbot: Lưu câu hỏi vào chat_history
            
            Chatbot->>VectorStore: Truy vấn tương tự
            VectorStore->>DB: Tìm kiếm vector gần nhất
            DB-->>VectorStore: Kết quả tìm kiếm
            VectorStore-->>Chatbot: Trả về dữ liệu tương tự
            
            Chatbot->>Chain: Chạy chuỗi RAG
            Chain->>LLM: Truy vấn với ngữ cảnh và lịch sử
            LLM-->>Chain: Tạo ra câu trả lời
            Chain-->>Chatbot: Trả về câu trả lời
            
            Chatbot->>Chatbot: Lưu câu trả lời vào chat_history
            Chatbot-->>CLI: Trả về câu trả lời
            CLI-->>User: Hiển thị câu trả lời
        end
    end